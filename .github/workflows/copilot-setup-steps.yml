name: Copilot Setup Steps

# 触发条件：可以手动触发，或者在修改此文件时触发（方便测试）
on:
  workflow_dispatch:
  push:
    paths:
      - .github/workflows/copilot-setup-steps.yml

permissions:
  contents: read

jobs:
  # Job ID 必须严格命名为 'copilot-setup-steps'
  # Copilot Agent 会专门寻找这个名字的 job 来初始化环境
  copilot-setup-steps:
    runs-on: ubuntu-latest

    steps:
      - name: Checkout repository
        uses: actions/checkout@v4

      - name: Update apt database
        run: sudo apt-get update

      # 安装 Tauri v2 编译所需的所有 Linux 系统依赖
      # 包含 glib, gtk3, webkit2gtk, appindicator 等
      - name: Install Tauri System Dependencies
        run: |
          sudo apt-get install -y \
            pkg-config \
            build-essential \
            libglib2.0-dev \
            libgtk-3-dev \
            libwebkit2gtk-4.1-dev \
            libayatana-appindicator3-dev \
            librsvg2-dev \
            libssl-dev \
            curl \
            wget \
            file

      # 验证环境：确保 pkg-config 能找到 glib
      # 如果这一步成功，后续的 cargo build 就不会报 glib-sys 错误
      - name: Verify GLib Environment
        run: pkg-config --cflags --libs glib-2.0

      # 安装 Node.js (前端构建)
      - name: Setup Node.js
        uses: actions/setup-node@v4
        with:
          node-version: '20'

      # 安装 Rust (后端构建)
      - name: Setup Rust
        uses: dtolnay/rust-toolchain@stable

      # 安装前端依赖
      # - name: Install NPM dependencies
      #   run: npm install

      # 预下载 Rust 依赖（只下载不编译，加速后续 Agent 的操作）
      # - name: Fetch Rust dependencies
      #   run: cargo fetch